<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>astrodata.nddata &mdash; astrodata 0.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../_static/../manuals/_static/color_styles.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/logo_variables.css?v=947f2b5d" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=7026087e"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            astrodata
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manuals/index.html">Astrodata Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_short.html">Common API for Users</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">astrodata</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../astrodata.html">astrodata</a></li>
      <li class="breadcrumb-item active">astrodata.nddata</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for astrodata.nddata</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Implementations of NDData-like classes for |AstroData| objects.</span>

<span class="sd">This module implements a derivative class based on NDData with some Mixins,</span>
<span class="sd">implementing windowing and on-the-fly data scaling.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io.fits</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageHDU</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.modeling</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.nddata</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">NDArithmeticMixin</span><span class="p">,</span>
    <span class="n">NDData</span><span class="p">,</span>
    <span class="n">NDSlicingMixin</span><span class="p">,</span>
    <span class="n">VarianceUncertainty</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gwcs.wcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">WCS</span> <span class="k">as</span> <span class="n">gWCS</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.wcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_axis_from_frame</span>

<span class="n">INTEGER_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NDAstroData&quot;</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ADVarianceUncertainty</span><span class="p">(</span><span class="n">VarianceUncertainty</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subclass VarianceUncertainty to check for negative values.&quot;&quot;&quot;</span>

    <span class="nd">@VarianceUncertainty</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Negative variance values found. Setting to zero.&quot;</span><span class="p">,</span>
                <span class="ne">RuntimeWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">VarianceUncertainty</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<div class="viewcode-block" id="AstroDataMixin">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.AstroDataMixin">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AstroDataMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin with AstroData-like behavior for NDData-like classes.</span>

<span class="sd">    Mixin for ``NDData``-like classes (such as ``Spectrum1D``) to enable</span>
<span class="sd">    them to behave similarly to ``AstroData`` objects.</span>

<span class="sd">    These behaviors are:</span>
<span class="sd">        1.  ``mask`` attributes are combined with bitwise, not logical, or,</span>
<span class="sd">            since the individual bits are important.</span>
<span class="sd">        2.  The WCS must be a ``gwcs.WCS`` object and slicing results in</span>
<span class="sd">            the model being modified.</span>
<span class="sd">        3.  There is a settable ``variance`` attribute.</span>
<span class="sd">        4.  Additional attributes such as OBJMASK can be extracted from</span>
<span class="sd">            the .meta[&#39;other&#39;] dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AstroDataMixin.__getattr__">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.AstroDataMixin.__getattr__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access attributes stored in self.meta[&#39;other&#39;].</span>

<span class="sd">        Required to access attributes like |AstroData| objects. See the</span>
<span class="sd">        documentation for |AstroData|&#39;s ``__getattr__`` method for more</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>

            <span class="c1"># Does this ever happen? If so under what circumstances?</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> object has no &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;attribute </span><span class="si">{</span><span class="n">attribute</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_arithmetic</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">,</span>
        <span class="n">operand</span><span class="p">,</span>
        <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">handle_mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bitwise_or</span><span class="p">,</span>
        <span class="n">handle_meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">uncertainty_correlation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">compare_wcs</span><span class="o">=</span><span class="s2">&quot;first_found&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform arithmetic operations on the data.</span>

<span class="sd">        Overrides the NDData method so that &quot;bitwise_or&quot; becomes the default</span>
<span class="sd">        operation to combine masks, rather than &quot;logical_or&quot;</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This method is not intended to be called directly. Use the</span>
<span class="sd">            arithmetic methods of the NDData object instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_arithmetic</span><span class="p">(</span>
            <span class="n">operation</span><span class="p">,</span>
            <span class="n">operand</span><span class="p">,</span>
            <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="n">propagate_uncertainties</span><span class="p">,</span>
            <span class="n">handle_mask</span><span class="o">=</span><span class="n">handle_mask</span><span class="p">,</span>
            <span class="n">handle_meta</span><span class="o">=</span><span class="n">handle_meta</span><span class="p">,</span>
            <span class="n">uncertainty_correlation</span><span class="o">=</span><span class="n">uncertainty_correlation</span><span class="p">,</span>
            <span class="n">compare_wcs</span><span class="o">=</span><span class="n">compare_wcs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_slice_wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slice the WCS object.</span>

<span class="sd">        The ``__call__()`` method of gWCS doesn&#39;t appear to conform to the</span>
<span class="sd">        APE 14 interface for WCS implementations, and doesn&#39;t react to slicing</span>
<span class="sd">        properly. We override NDSlicing&#39;s method to do what we want.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        slices : slice or tuple of slices</span>
<span class="sd">            The slice or slices to apply to the WCS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">,</span> <span class="n">gWCS</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span>

        <span class="c1"># Sanitize the slices, catching some errors early</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slices</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">slices</span> <span class="o">=</span> <span class="p">(</span><span class="n">slices</span><span class="p">,)</span>
        <span class="n">slices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ndim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Too many dimensions specified in slice </span><span class="si">{</span><span class="n">slices</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">Ellipsis</span> <span class="ow">in</span> <span class="n">slices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slices</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="s2">&quot;Only one ellipsis can be specified in a slice&quot;</span>
                <span class="p">)</span>

            <span class="n">ell_index</span> <span class="o">=</span> <span class="n">slices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">)</span>
            <span class="n">slice_fill</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">slices</span><span class="p">[</span><span class="n">ell_index</span> <span class="p">:</span> <span class="n">ell_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">slice_fill</span>

        <span class="n">slices</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)))</span>

        <span class="n">mods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mapped_axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">slice_</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">slices</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slice_</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">slice_</span><span class="o">.</span><span class="n">step</span> <span class="ow">and</span> <span class="n">slice_</span><span class="o">.</span><span class="n">step</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Cannot slice with a step&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">slice_</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">length</span> <span class="o">+</span> <span class="n">slice_</span><span class="o">.</span><span class="n">start</span>
                        <span class="k">if</span> <span class="n">slice_</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="n">slice_</span><span class="o">.</span><span class="n">start</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Shift</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
                <span class="n">mapped_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">mapped_axes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mapped_axes</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slice_</span><span class="p">,</span> <span class="n">INTEGER_TYPES</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">models</span><span class="o">.</span><span class="n">Const1D</span><span class="p">((</span><span class="n">length</span> <span class="o">+</span> <span class="n">slice_</span><span class="p">)</span> <span class="k">if</span> <span class="n">slice_</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">slice_</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">mapped_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Equivalent to slice(None, None, None)</span>
            <span class="k">elif</span> <span class="n">slice_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mapped_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">mapped_axes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mapped_axes</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Slice not an integer or range&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
                <span class="n">mods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="fm">__or__</span><span class="p">,</span> <span class="n">model</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the previous model was an Identity, we can hang this</span>
                <span class="c1"># one onto that without needing to append a new Identity</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mods</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">models</span><span class="o">.</span><span class="n">Identity</span><span class="p">):</span>
                    <span class="n">mods</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="n">mods</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">n_inputs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">slicing_model</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="fm">__and__</span><span class="p">,</span> <span class="n">mods</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mapped_axes</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ndim</span><span class="p">)):</span>
            <span class="n">slicing_model</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">models</span><span class="o">.</span><span class="n">Mapping</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">mapped_axes</span><span class="p">))</span>
                <span class="o">|</span> <span class="n">slicing_model</span>
            <span class="p">)</span>
            <span class="n">slicing_model</span><span class="o">.</span><span class="n">inverse</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Mapping</span><span class="p">(</span>
                <span class="nb">tuple</span><span class="p">(</span><span class="n">ax</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">mapped_axes</span> <span class="k">if</span> <span class="n">ax</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">n_inputs</span><span class="o">=</span><span class="n">ndim</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicing_model</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Identity</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">slicing_model</span><span class="o">.</span><span class="n">n_inputs</span> <span class="o">==</span> <span class="n">ndim</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span>  <span class="c1"># Unchanged!</span>
        <span class="n">new_wcs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">input_frame</span> <span class="o">=</span> <span class="n">new_wcs</span><span class="o">.</span><span class="n">input_frame</span>
        <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">mapped_axis</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">mapped_axes</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">mapped_axis</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">input_frame</span> <span class="o">=</span> <span class="n">remove_axis_from_frame</span><span class="p">(</span><span class="n">input_frame</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="n">new_wcs</span><span class="o">.</span><span class="n">pipeline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">input_frame</span>
        <span class="n">new_wcs</span><span class="o">.</span><span class="n">insert_transform</span><span class="p">(</span>
            <span class="n">new_wcs</span><span class="o">.</span><span class="n">input_frame</span><span class="p">,</span> <span class="n">slicing_model</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_wcs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the contents of ``uncertainty``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@variance</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ADVarianceUncertainty</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the WCS of the data as a gWCS object.</span>

<span class="sd">        This is a gWCS object, not a FITS WCS object.</span>

<span class="sd">        This is returning wcs from an inhertited class, see NDData.wcs for more</span>
<span class="sd">        details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wcs</span>

    <span class="nd">@wcs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">gWCS</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;wcs value must be None or a gWCS object&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wcs</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The shape of the data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The size of the data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">size</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">FakeArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fake array class for lazy-loaded data.</span>

<span class="sd">    A class that pretends to be an array, but is actually a lazy-loaded.</span>
<span class="sd">    This is used to fool the NDData class into thinking it has an array</span>
<span class="sd">    when it doesn&#39;t.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">very_faked</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">very_faked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Won&#39;t matter. This is just to fool NDData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>  <span class="c1"># Same here</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>


<span class="k">class</span><span class="w"> </span><span class="nc">NDWindowing</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Window access to an ``NDAstroData`` instance.</span>

<span class="sd">    A class to allow &quot;windowed&quot; access to some properties of an</span>
<span class="sd">    ``NDAstroData`` instance. In particular, ``data``, ``uncertainty``,</span>
<span class="sd">    ``variance``, and ``mask`` return clipped data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="n">target</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_slice</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NDWindowingAstroData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window_slice</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">NDWindowingAstroData</span><span class="p">(</span>
    <span class="n">AstroDataMixin</span><span class="p">,</span> <span class="n">NDArithmeticMixin</span><span class="p">,</span> <span class="n">NDSlicingMixin</span><span class="p">,</span> <span class="n">NDData</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement windowed access to an ``NDAstroData`` instance.</span>

<span class="sd">    Provide &quot;windowed&quot; access to some properties of an ``NDAstroData``</span>
<span class="sd">    instance.  In particular, ``data``, ``uncertainty``, ``variance``, and</span>
<span class="sd">    ``mask`` return clipped data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=super-init-not-called</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="n">window</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access attributes stored in self.meta[&#39;other&#39;].</span>

<span class="sd">        This is required to access attributes like |AstroData| objects. See the</span>
<span class="sd">        documentation for |AstroData|&#39;s ``__getattr__`` method for more</span>
<span class="sd">        information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">_get_simple</span><span class="p">(</span>
                    <span class="n">attribute</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_window</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> object has no &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;attribute </span><span class="si">{</span><span class="n">attribute</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">unit</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">_slice_wcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">_get_simple</span><span class="p">(</span><span class="s2">&quot;_data&quot;</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">_get_uncertainty</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">array</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">_get_simple</span><span class="p">(</span><span class="s2">&quot;_mask&quot;</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">is_lazy</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the item is a lazy-loaded object, False otherwise.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ImageHDU</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;lazy&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>


<div class="viewcode-block" id="NDAstroData">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.NDAstroData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NDAstroData</span><span class="p">(</span><span class="n">AstroDataMixin</span><span class="p">,</span> <span class="n">NDArithmeticMixin</span><span class="p">,</span> <span class="n">NDSlicingMixin</span><span class="p">,</span> <span class="n">NDData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Primary data class for AstroData objects.</span>

<span class="sd">    Implements ``NDData`` with all Mixins, plus some ``AstroData`` specifics.</span>

<span class="sd">    This class implements an ``NDData``-like container that supports reading</span>
<span class="sd">    and writing as implemented in the ``astropy.io.registry`` and also slicing</span>
<span class="sd">    (indexing) and simple arithmetics (add, subtract, divide and multiply).</span>

<span class="sd">    A very important difference between ``NDAstroData`` and ``NDData`` is that</span>
<span class="sd">    the former attempts to load all its data lazily. There are also some</span>
<span class="sd">    important differences in the interface (eg. ``.data`` lets you reset its</span>
<span class="sd">    contents after initialization).</span>

<span class="sd">    Documentation is provided where our class differs.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    NDData</span>
<span class="sd">    NDArithmeticMixin</span>
<span class="sd">    NDSlicingMixin</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The mixins allow operation that are not possible with ``NDData`` or</span>
<span class="sd">    ``NDDataBase``, i.e. simple arithmetics::</span>

<span class="sd">        &gt;&gt;&gt; from astropy.nddata import StdDevUncertainty</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; data = np.ones((3,3), dtype=float)</span>
<span class="sd">        &gt;&gt;&gt; ndd1 = NDAstroData(data, uncertainty=StdDevUncertainty(data))</span>
<span class="sd">        &gt;&gt;&gt; ndd2 = NDAstroData(data, uncertainty=StdDevUncertainty(data))</span>
<span class="sd">        &gt;&gt;&gt; ndd3 = ndd1.add(ndd2)</span>
<span class="sd">        &gt;&gt;&gt; ndd3.data</span>
<span class="sd">        array([[2., 2., 2.],</span>
<span class="sd">            [2., 2., 2.],</span>
<span class="sd">            [2., 2., 2.]])</span>
<span class="sd">        &gt;&gt;&gt; ndd3.uncertainty.array</span>
<span class="sd">        array([[1.41421356, 1.41421356, 1.41421356],</span>
<span class="sd">            [1.41421356, 1.41421356, 1.41421356],</span>
<span class="sd">            [1.41421356, 1.41421356, 1.41421356]])</span>

<span class="sd">    see ``NDArithmeticMixin`` for a complete list of all supported arithmetic</span>
<span class="sd">    operations.</span>

<span class="sd">    But also slicing (indexing) is possible::</span>

<span class="sd">        &gt;&gt;&gt; ndd4 = ndd3[1,:]</span>
<span class="sd">        &gt;&gt;&gt; ndd4.data</span>
<span class="sd">        array([2., 2., 2.])</span>
<span class="sd">        &gt;&gt;&gt; ndd4.uncertainty.array</span>
<span class="sd">        array([1.41421356, 1.41421356, 1.41421356])</span>

<span class="sd">    See ``NDSlicingMixin`` for a description how slicing works (which</span>
<span class="sd">    attributes) are sliced.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="NDAstroData.__init__">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.NDAstroData.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">uncertainty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">variance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize an ``NDAstroData`` instance.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        data : array-like</span>
<span class="sd">            The actual data. This can be a numpy array, a memmap, or a</span>
<span class="sd">            ``fits.ImageHDU`` object.</span>

<span class="sd">        uncertainty : ``NDUncertainty``-like object, optional</span>
<span class="sd">            An object that represents the uncertainty of the data. If not</span>
<span class="sd">            specified, the uncertainty will be set to None.</span>

<span class="sd">        mask : array-like, optional</span>
<span class="sd">            An array that represents the mask of the data. If not specified,</span>
<span class="sd">            the mask will be set to None.</span>

<span class="sd">        wcs : ``gwcs.WCS`` object, optional</span>
<span class="sd">            The WCS of the data. If not specified, the WCS will be set to None.</span>

<span class="sd">        meta : dict-like, optional</span>
<span class="sd">            A dictionary-like object that holds the meta data. If not</span>
<span class="sd">            specified, the meta data will be set to None.</span>

<span class="sd">        unit : ``astropy.units.Unit`` object, optional</span>
<span class="sd">            The unit of the data. If not specified, the unit will be set to</span>
<span class="sd">            None.</span>

<span class="sd">        copy : bool, optional</span>
<span class="sd">            If True, the data, uncertainty, mask, wcs, meta, and unit will be</span>
<span class="sd">            copied. Otherwise, they will be referenced. Default is False.</span>

<span class="sd">        variance : array-like, optional</span>
<span class="sd">            An array that represents the variance of the data. If not</span>
<span class="sd">            specified, the variance will be set to None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If ``uncertainty`` and ``variance`` are both specified.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The ``uncertainty`` and ``variance`` parameters are mutually exclusive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot specify both uncertainty and variance&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">uncertainty</span><span class="w"> </span><span class="si">= }</span><span class="s2">, </span><span class="si">{</span><span class="n">variance</span><span class="w"> </span><span class="si">= }</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

            <span class="n">uncertainty</span> <span class="o">=</span> <span class="n">ADVarianceUncertainty</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">FakeArray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span><span class="p">,</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="n">uncertainty</span><span class="p">)</span> <span class="k">else</span> <span class="n">uncertainty</span><span class="p">,</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="n">wcs</span><span class="p">,</span>
            <span class="n">meta</span><span class="p">,</span>
            <span class="n">unit</span><span class="p">,</span>
            <span class="n">copy</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="n">uncertainty</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="n">uncertainty</span></div>


<div class="viewcode-block" id="NDAstroData.__deepcopy__">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.NDAstroData.__deepcopy__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the deepcopy protocol for this class.</span>

<span class="sd">        This implementation accounts for the lazy-loading of the data and</span>
<span class="sd">        uncertainty attributes. It also avoids recursion when copying the</span>
<span class="sd">        uncertainty attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="k">else</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span> <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask</span><span class="p">)</span> <span class="k">else</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">memo</span><span class="p">)</span>
        <span class="c1"># Needed to avoid recursion because of uncertainty&#39;s weakref to self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_lazy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span><span class="p">):</span>
            <span class="n">new</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access a slice of the data.</span>

<span class="sd">        Interface to access a section of the data, using lazy access</span>
<span class="sd">        whenever possible.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        An instance of ``NDWindowing``, which provides ``__getitem__``,</span>
<span class="sd">        to allow the use of square brackets when specifying the window.</span>
<span class="sd">        Ultimately, an ``NDWindowingAstrodata`` instance is returned.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; ad[0].nddata.window[100:200, 100:200]  # doctest: +SKIP</span>
<span class="sd">        &lt;NDWindowingAstrodata .....&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">NDWindowing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the ADVarianceUncertainty object, or a slice of it.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        section : slice, optional</span>
<span class="sd">            The slice to apply to the uncertainty object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ADVarianceUncertainty</span>
<span class="sd">            The uncertainty object, or a slice of it if a section is provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="n">ADVarianceUncertainty</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span>

                <span class="k">return</span> <span class="n">ADVarianceUncertainty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span><span class="p">[</span><span class="n">section</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span><span class="p">[</span><span class="n">section</span><span class="p">]</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the section of image-like objects, or the whole object.</span>

<span class="sd">        Only use &#39;section&#39; for image-like objects that have the same shape</span>
<span class="sd">        as the NDAstroData object; otherwise, return the whole object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO(teald): Unclear description of what this method does.</span>
        <span class="n">source</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                    <span class="n">ret</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">data</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">section</span><span class="p">]</span>

                <span class="k">return</span> <span class="n">ret</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">section</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="n">section</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">source</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the data stored in this instance. It implements a setter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_simple</span><span class="p">(</span><span class="s2">&quot;_data&quot;</span><span class="p">)</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot set data to </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">header</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or set the uncertainty of the data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_uncertainty</span><span class="p">()</span>

    <span class="nd">@uncertainty</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_lazy</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># TODO: Accessing protected member from value</span>
            <span class="c1"># pylint: disable=protected-access</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">_parent_nddata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">value</span><span class="o">.</span><span class="n">parent_nddata</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or set the mask of the data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_simple</span><span class="p">(</span><span class="s2">&quot;_mask&quot;</span><span class="p">)</span>

    <span class="nd">@mask</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get and aset the variance of the data.</span>

<span class="sd">        A convenience property to access the contents of ``uncertainty``,</span>
<span class="sd">        squared (as the uncertainty data is stored as standard deviation).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO(teald): Refactor uncertainty and variance implementation.</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_uncertainty</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span>

        <span class="k">return</span> <span class="n">arr</span>

    <span class="nd">@variance</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ADVarianceUncertainty</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

<div class="viewcode-block" id="NDAstroData.set_section">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.NDAstroData.set_section">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">input_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a section of the data to the input data.</span>

<span class="sd">        Sets only a section of the data. This method is meant to prevent</span>
<span class="sd">        fragmentation in the Python heap, by reusing the internal structures</span>
<span class="sd">        instead of replacing them with new ones.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        section : ``slice``</span>
<span class="sd">            The area that will be replaced</span>

<span class="sd">        input_data : ``NDData``-like instance</span>
<span class="sd">            This object needs to implement at least ``data``, ``uncertainty``,</span>
<span class="sd">            and ``mask``. Their entire contents will replace the data in the</span>
<span class="sd">            area defined by ``section``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; def setup():</span>
<span class="sd">        ...     sec = NDData(np.zeros((100,100)))</span>
<span class="sd">        ...     ad[0].nddata.set_section(</span>
<span class="sd">        ...         (slice(None,100),slice(None,100)),</span>
<span class="sd">        ...         sec</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; setup()  # doctest: +SKIP</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">array</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">mask</span></div>


<div class="viewcode-block" id="NDAstroData.__repr__">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.NDAstroData.__repr__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the object.</span>

<span class="sd">        If the data is lazy-loaded, the string representation will include</span>
<span class="sd">        the class name and the string &quot;(Memmapped)&quot;, representing that this</span>
<span class="sd">        memory may not have been loaded in yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO(teald): Check that repr reverts to normal behavior after loading</span>
        <span class="k">if</span> <span class="n">is_lazy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;(Memmapped)&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span></div>


    <span class="c1"># This is a common idiom in numpy, so keep the name.</span>
    <span class="c1"># pylint: disable=invalid-name</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transpose the data. This is not a copy of the data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

<div class="viewcode-block" id="NDAstroData.transpose">
<a class="viewcode-back" href="../../manuals/full_api.html#astrodata.NDAstroData.transpose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transpose the data. This is not a copy of the data.&quot;&quot;&quot;</span>
        <span class="n">unc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span>
        <span class="n">new_wcs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
        <span class="n">inframe</span> <span class="o">=</span> <span class="n">new_wcs</span><span class="o">.</span><span class="n">input_frame</span>
        <span class="n">new_wcs</span><span class="o">.</span><span class="n">insert_transform</span><span class="p">(</span>
            <span class="n">inframe</span><span class="p">,</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Mapping</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">inframe</span><span class="o">.</span><span class="n">naxes</span><span class="p">)))),</span>
            <span class="n">after</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">uncertainty</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">unc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">unc</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">unc</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
            <span class="n">mask</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">wcs</span><span class="o">=</span><span class="n">new_wcs</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span>
            <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slice metadata like OBJMASK.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_slice</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;other&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;other&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;other&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">kwargs</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-present, NOIRLab/Gemini Observatories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>